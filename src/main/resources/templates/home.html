<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oasis - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-oasis-gradient { background: linear-gradient(135deg, #D8EBF1 0%, #E8DCC6 100%); background-attachment: fixed; }
        .text-brand { color: #1B3A4B; }
        .bg-brand { background-color: #2A8C82; }
        .btn-brand { background-color: #2A8C82; border: none; color: white; }
        .btn-brand:hover { background-color: #206e66; }
    </style>
</head>
<body class="min-h-screen bg-oasis-gradient text-[#1B3A4B]">

    <div class="navbar bg-white/60 backdrop-blur-md shadow-sm px-6 sticky top-0 z-50 border-b border-white/20 flex justify-between">
        <div class="flex items-center gap-2">
            <a class="text-2xl font-extrabold text-brand tracking-[0.15em] uppercase cursor-pointer">Oásîs</a>
            <div class="hidden md:flex badge bg-white/50 border-none text-brand font-semibold shadow-sm">Java Advanced</div>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="avatar placeholder">
                <div class="bg-brand text-white rounded-full w-8 ring ring-white ring-offset-2 shadow-md"><span class="text-xs font-bold">US</span></div>
            </div>

            <form th:action="@{/logout}" method="post" class="flex items-center">
                <button type="submit" class="btn btn-circle btn-ghost btn-sm hover:bg-red-100 hover:text-red-500" title="Sair do Sistema">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <div class="container mx-auto p-6 max-w-6xl">
        
        <div th:if="${param.error}" class="alert alert-warning shadow-lg mb-6">
            <span>Atenção: IA instável. Modo offline ativado.</span>
        </div>

        <div class="flex flex-col md:flex-row justify-between items-center mb-12 mt-8 gap-6">
            <div class="text-center md:text-left">
                <h1 class="text-4xl font-bold text-brand mb-2">Seus Rituais</h1>
                <p class="text-brand opacity-70 font-medium">Gerencie seu equilíbrio híbrido.</p>
            </div>
            <button onclick="my_modal_1.showModal()" class="btn btn-brand shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all px-8 h-12 text-sm tracking-wider font-bold uppercase rounded-full">
                <span class="text-lg mr-1">+</span> Novo Ritual
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            
            <div th:each="ritual : ${rituais}" class="card bg-white/80 backdrop-blur-md shadow-xl hover:shadow-2xl transition-all duration-300 border-t-4 border-brand group">
                <div class="card-body p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="card-title text-lg text-brand font-bold" th:text="${ritual.titulo}">Título</h2>
                        <div class="badge bg-brand text-white border-none font-bold shadow-sm" th:text="${ritual.duracaoMinutos} + ' min'">10 min</div>
                    </div>
                    
                    <div class="h-px w-full bg-gradient-to-r from-transparent via-gray-300 to-transparent mb-4 opacity-50"></div>
                    
                    <p th:text="${ritual.descricaoGeradaPorIA}" class="text-sm text-gray-600 leading-relaxed min-h-[60px]">Descrição...</p>
                    
                    <div class="card-actions justify-end mt-6 items-center gap-2">
                        <a th:href="@{/app/rituais/editar/{id}(id=${ritual.id})}" class="btn btn-sm btn-ghost text-blue-600 hover:bg-blue-50">Editar</a>

                        <form th:action="@{/app/rituais/deletar/{id}(id=${ritual.id})}" method="post">
                            <button type="submit" class="btn btn-sm btn-ghost text-brand hover:bg-red-100 hover:text-red-500">Arquivar</button>
                        </form>
                        
                        <button th:onclick="iniciarTimer([[${ritual.duracaoMinutos}]], [[${ritual.titulo}]])" class="btn btn-sm btn-brand px-6 shadow-md">
                            Iniciar
                        </button>
                    </div>
                </div>
            </div>

            <div th:if="${rituais.empty}" class="col-span-full py-24 flex flex-col items-center justify-center text-center bg-white/40 rounded-3xl border-2 border-dashed border-brand/30">
                <h3 class="text-2xl font-bold text-brand mb-2">Comece sua jornada</h3>
                <p class="max-w-md text-brand opacity-70">Nenhum ritual encontrado.</p>
            </div>
        </div>
    </div>

    <dialog id="my_modal_1" class="modal modal-bottom sm:modal-middle backdrop-blur-sm">
        <div class="modal-box bg-white border-t-8 border-brand p-8">
            <h3 class="font-bold text-2xl mb-2 text-brand">Gerar Ritual</h3>
            <p class="text-sm text-gray-500 mb-8">A IA vai criar algo personalizado.</p>
            <form action="/app/rituais/novo" method="post">
                <div class="form-control w-full mb-5">
                    <label class="label p-0 mb-2"><span class="label-text font-bold text-xs text-brand opacity-70">TÍTULO</span></label>
                    <input type="text" name="titulo" class="input input-bordered w-full bg-gray-50" required />
                </div>
                <div class="form-control w-full mb-5">
                    <label class="label p-0 mb-2"><span class="label-text font-bold text-xs text-brand opacity-70">COMO VOCÊ SE SENTE?</span></label>
                    <textarea name="objetivo" class="textarea textarea-bordered h-28 bg-gray-50" required></textarea>
                </div>
                <div class="form-control w-full mb-8">
                    <label class="label p-0 mb-2">
                        <span class="label-text font-bold text-xs text-brand opacity-70">DURAÇÃO</span>
                        <span id="timeVal" class="font-bold text-brand text-sm bg-brand/10 px-2 py-1 rounded">5 min</span>
                    </label>
                    <input type="range" min="1" max="10" value="5" class="range range-xs accent-[#2A8C82]" style="color: #2A8C82;" name="duracaoMinutos" oninput="timeVal.innerText = this.value + ' min'" />
                </div>
                <div class="modal-action flex justify-between items-center">
                    <form method="dialog"><button class="btn btn-ghost text-gray-400">Cancelar</button></form>
                    <button type="submit" onclick="this.classList.add('loading', 'btn-disabled')" class="btn btn-brand px-8">CRIAR COM IA ✨</button>
                </div>
            </form>
        </div>
        <form method="dialog" class="modal-backdrop"><button>close</button></form>
    </dialog>


    <dialog id="timer_modal" class="modal backdrop-blur-md">
        <div class="modal-box bg-brand text-white text-center py-12">
            <h3 id="timerTitle" class="font-bold text-3xl mb-2 opacity-90">Título do Ritual</h3>
            <p class="opacity-70 mb-8">Concentre-se e respire.</p>
            
            <div class="text-8xl font-black font-mono mb-8 tracking-widest">
                <span id="timerDisplay">00:00</span>
            </div>
            
            <div class="modal-action justify-center">
                <form method="dialog">
                    <button onclick="pararTimer()" class="btn btn-white text-brand hover:bg-gray-200 px-8 font-bold">
                        Encerrar Ritual
                    </button>
                </form>
            </div>
        </div>
    </dialog>

    <script>
        let interval; 

        function iniciarTimer(minutos, titulo) {
            
            document.getElementById('timerTitle').innerText = titulo;
            
           
            let tempoRestante = minutos * 60;
            
            const display = document.getElementById('timerDisplay');
            const modal = document.getElementById('timer_modal');

            
            modal.showModal();

           
            function atualizarDisplay() {
                let m = Math.floor(tempoRestante / 60);
                let s = tempoRestante % 60;
                
                
                m = m < 10 ? '0' + m : m;
                s = s < 10 ? '0' + s : s;
                
                display.innerText = `${m}:${s}`;

                if (tempoRestante <= 0) {
                    clearInterval(interval);
                    display.innerText = "FIM!";
                    // Poderia tocar um som aqui
                }
                tempoRestante--;
            }

            
            atualizarDisplay();
            clearInterval(interval); 
            interval = setInterval(atualizarDisplay, 1000);
        }

        function pararTimer() {
            clearInterval(interval);
        }
    </script>

</body>
</html>